<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extractor config file &mdash; CmonCrawl 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=8d563738"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extraction utils" href="utils.html" />
    <link rel="prev" title="Extractor types" href="creating_extractor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CmonCrawl
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Extraction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="creating_extractor.html">Extractor types</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_extractor.html#extractor-definition">Extractor Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating_extractor.html#baseextractor">BaseExtractor</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extractor config file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure">Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#init-py"><cite>__init__.py</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#arbitrary-code-execution">Arbitrary Code Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Extraction utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CmonCrawl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Extraction</a></li>
      <li class="breadcrumb-item active">Extractor config file</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/extraction/config_file.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="extractor-config-file">
<span id="extractor-config"></span><h1>Extractor config file<a class="headerlink" href="#extractor-config-file" title="Link to this heading"></a></h1>
<p>In many cases you will want to use more than single extractor.
Imagine if you crawl two news websites which have completely different structure
and you want to extract the article. You can achieve this by using the Extractor config file.</p>
<p>The extractor config file, defines what extractor should be used for a given HTML file.
You can leverage datetime of the crawl and url to specify which extractor should be used.</p>
<section id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Link to this heading"></a></h2>
<p>The structure is following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="w">    </span><span class="nt">&quot;extractors_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Path to the extractors folder&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;routes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;regexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;.*&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;extractors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_extractor&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;since&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iso date string&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iso date string&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_extractor2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;regexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;another_regex&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;....&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;....&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">extractors_path</span></code> is the path to the folder where the extractors are located.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The extractors_path is relative to the current working directory.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">routes</span></code> defined a list of possible extractors and conditions we can route to. Each route is a dictionary with the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">regexes</span></code>: a list of regexes. At least one regex must match the url, for this route to be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extractors</span></code>: a list of extractors that will be used to extract the data from the url. The first extractor for which <code class="docutils literal notranslate"><span class="pre">since</span></code> &lt; record_date &lt; <code class="docutils literal notranslate"><span class="pre">to</span></code> is used.</p></li>
</ul>
<p>Each extractor has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the extractor. This is the name of the python file without the .py extension, you can also set NAME variable in the extractor file to override this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">since</span></code> [optional] : The starting crawl date for which the extractor is valid (e.g. 2009-01-01)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to</span></code> [optional] : The ending crawl date for which the extractor is valid.  Format is the same as for <code class="docutils literal notranslate"><span class="pre">since</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">since</span></code> and <code class="docutils literal notranslate"><span class="pre">to</span></code> are not specified, the extractor will match for all crawls for that route.</p>
</div>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p>Given the following folder structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>extractors/
├── a_extractor.py
├── a_extractor2.py
└── b_extractor.py
</pre></div>
</div>
<p>and the following config:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="w">    </span><span class="nt">&quot;extractors_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./extractors&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;routes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;regexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;.*cmon.cz.*&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;extractors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a_extractor&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2010-01-01&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a_extractor2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;since&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2010-01-01&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;regexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;.*cmon2.cz.*&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;extractors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b_extractor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following will happen:</p>
<ul class="simple">
<li><p>A domain record with url <a class="reference external" href="http://www.cmon.cz">http://www.cmon.cz</a>, cralwed on 2012 will be extracted using the a_extractor2.py extractor.</p></li>
<li><p>A domain record with url <a class="reference external" href="http://www.cmon.cz">http://www.cmon.cz</a>, cralwed on 2009 will be extracted using the a_extractor.py extractor.</p></li>
<li><p>A domain record with url <a class="reference external" href="http://www.cmon2.cz">http://www.cmon2.cz</a>, cralwed on 2012 will be extracted using the b_extractor.py extractor.</p></li>
</ul>
</section>
<section id="init-py">
<h2><cite>__init__.py</cite><a class="headerlink" href="#init-py" title="Link to this heading"></a></h2>
<p>You might want to put the common code of the extractors into
a common python file. The problem is that during the execution,
the extractors directory is not in the python path. To add the extractors
directory we also load <cite>__init__.py`</cite> file (But don’t add load extractors in it).</p>
<p>Thus you can create <cite>__init__.py</cite> file in the extractors directory with the following content:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</pre></div>
</div>
<p>which will add the extractors directory to the python path.</p>
</section>
<section id="arbitrary-code-execution">
<h2>Arbitrary Code Execution<a class="headerlink" href="#arbitrary-code-execution" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since the router, loads and executes all files in the extractors
directory, every .py file in this directory is executed. Thus
you should not put any untrusted files in this directory.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="creating_extractor.html" class="btn btn-neutral float-left" title="Extractor types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="utils.html" class="btn btn-neutral float-right" title="Extraction utils" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Hynek Kydlíček.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>